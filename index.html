<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kelola Kita - Manajemen Uang Kas</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="sidebar">
        <div class="logo">
            <div class="logo-text">
                <div class="logo-main"><span class="logo-icon">Kelola</span> Kita</div>
                <div class="logo-sub">Manajemen Uang Kas</div>
            </div>
        </div>

        <div class="menu">
            <div class="menu-item active" onclick="showPage('home')">
                üè† <span>Beranda</span>
            </div>
            
            <div class="menu-item" onclick="showPage('transaction')">
                üìù <span>Catat Transaksi</span>
            </div>
            <div class="menu-item" onclick="showPage('analysis')">
                üìä <span>Monitor & Analisis</span>
            </div>
            <div class="menu-item" onclick="showPage('notification')">
                üîî <span>Notifikasi</span>
                <span class="notif-badge" id="notifCount" style="display:none; background:red; color:white; font-size:10px; padding:2px 6px; border-radius:10px; margin-left:auto;">0</span>
            </div>
            <div class="menu-item" onclick="showPage('settings')">
                ‚öôÔ∏è <span>Pengaturan</span>
            </div>
            <div class="menu-item">
                ‚ùì <span>Bantuan</span>
            </div>
        </div>
    </div>

    <div class="topbar">
        <div class="topbar-left">
            <div class="topbar-tab" onclick="showPage('transaction')">
                üìù <span>Catat transaksi</span>
            </div>
            <div class="topbar-tab" onclick="showPage('analysis')">
                üìä <span>Monitor & analisis</span>
            </div>
        </div>
        <div class="topbar-right">
            <div class="company-name" id="displayCompanyName">UNIVERSITAS BRAWIJAYA</div>
            <div class="icon-btn" onclick="showPage('notification')">üîî</div>
            <div class="icon-btn" onclick="showPage('settings')">‚öôÔ∏è</div>
            <div class="icon-btn">üë§</div>
        </div>
    </div>

    <div class="main-content">
        <div id="welcomePage" class="page active">
            <div class="welcome-page">
                <div class="welcome-card">
                    <div class="welcome-illustration">
                        <div class="floating-icon icon-chat">üí¨</div>
                        <div class="floating-icon icon-heart">‚ù§Ô∏è</div>
                        <div class="floating-icon icon-like">üëç</div>
                        <div class="illustration-people">
                            <span>üë©</span>
                            <span>üë®</span>
                        </div>
                    </div>
                    
                    <h1 class="welcome-title">Hallo <span id="welcomeName">Rifan</span>,</h1>
                    <p class="welcome-subtitle">
                        Selamat datang di <strong>Kelola Kita</strong>!<br>
                        Aplikasi khusus untuk mengelola <strong>uang kas</strong> secara rapi dan real-time.
                    </p>
                    
                    <button class="btn-start" onclick="showPage('onboarding')">
                        Mulai setup uang kas ‚â´
                    </button>

                    <div class="app-footer">
                        ¬© 2025 Kelola Kita v1.0.0 All rights reserved
                    </div>
                </div>
            </div>
        </div>

        <div id="onboardingPage" class="page">
            <div class="onboarding-container">
                <div class="onboarding-header">
                    <div class="onboarding-title">Setup Kelola Kita</div>
                    <p>Lengkapi informasi kas & bisnis Anda untuk memulai</p>
                </div>

                <div class="progress-bar">
                    <div class="progress-line"><div class="progress-line-fill" id="progressFill"></div></div>
                    <div class="progress-step"><div class="step-number active" id="step1">1</div></div>
                    <div class="progress-step"><div class="step-number" id="step2">2</div></div>
                    <div class="progress-step"><div class="step-number" id="step3">3</div></div>
                    <div class="progress-step"><div class="step-number" id="step4">4</div></div>
                </div>

                <div class="onboarding-content">
                    <div class="step-content active" id="content1">
                        <h2>Informasi Bisnis Anda</h2>
                        <div class="form-group">
                            <label>Nama Bisnis / Unit Kas *</label>
                            <input type="text" placeholder="Contoh: Kas BEM FILKOM" id="businessName">
                        </div>
                        <div class="form-group">
                            <label>Nama Anda (Admin)</label>
                            <input type="text" placeholder="Nama Panggilan" id="userNameInput" value="Rifan">
                        </div>
                    </div>

                    <div class="step-content" id="content2">
                        <h2>Detail Kontak</h2>
                        <div class="form-group">
                            <label>Email Penanggung Jawab</label>
                            <input type="email" id="email">
                        </div>
                        <div class="form-group">
                            <label>Target Saldo Minimum (Untuk Notifikasi)</label>
                            <input type="text" id="minBalance" value="100.000" placeholder="Rp" class="currency-input" inputmode="numeric">
                        </div>
                    </div>

                    <div class="step-content" id="content3">
                        <h2>Preferensi Uang Kas</h2>
                        <p class="subtitle">Tentukan saldo awal untuk memulai pembukuan.</p>

                        <div class="form-group">
                            <label style="color: #4F46E5; font-size: 16px;">üí∞ Saldo Awal Kas (Wajib Diisi)</label>
                            <input type="text" id="initialBalance" placeholder="0" style="font-weight: bold;" class="currency-input" inputmode="numeric">
                            <small style="color: #666;">Masukkan jumlah uang fisik/rekening yang ada saat ini.</small>
                        </div>

                        <div class="form-group">
                            <label>Mata Uang Utama</label>
                            <select id="currency">
                                <option value="IDR">IDR - Rupiah Indonesia</option>
                            </select>
                        </div>
                    </div>

                    <div class="step-content" id="content4">
                        <div style="text-align: center;">
                            <div class="success-icon">‚úì</div>
                            <h2>Setup Selesai!</h2>
                            <p class="subtitle">Data Anda telah siap. Klik tombol di bawah untuk masuk ke dashboard.</p>
                        </div>
                    </div>

                    <div class="button-group">
                        <button class="btn-back" id="backBtn" style="display: none;">Kembali</button>
                        <button class="btn-next" id="nextBtn">Lanjutkan</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="dashboardPage" class="page">
            <h1 style="margin-bottom: 24px; color: #1F2937;">Beranda (Ringkasan Kas)</h1>
            
            <div class="dashboard-grid">
                <div class="stat-card">
                    <div class="stat-title">Saldo kas saat ini</div>
                    <div class="stat-value" style="color: #4F46E5;" id="dashBalance">Rp 0</div>
                    <div class="stat-change" id="dashBalanceSub">Update Real-time</div>
                </div>

                <div class="stat-card">
                    <div class="stat-title">Transaksi bulan ini</div>
                    <div class="stat-value" id="dashTxCount">0 transaksi</div>
                    <div class="stat-change" id="dashTxDetail">üì• 0 masuk ¬∑ üì§ 0 keluar</div>
                </div>

                <div class="stat-card">
                    <div class="stat-title">Status Kas</div>
                    <div class="stat-value" id="dashStatus" style="font-size: 20px;">Aman</div>
                    <div class="stat-change" id="dashStatusSub">Diatas batas minimum</div>
                </div>

                <div class="stat-card">
                    <div class="stat-title">Arus Kas Bersih</div>
                    <div class="stat-value" id="dashNetFlow">Rp 0</div>
                    <div class="stat-change">Pemasukan - Pengeluaran</div>
                </div>
            </div>

            <div class="content-card" style="margin-top: 30px;">
                <h3>Transaksi Terakhir</h3>
                <div class="table-responsive">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Tanggal</th>
                                <th>Keterangan</th>
                                <th>Kategori</th>
                                <th>Tipe</th>
                                <th>Jumlah</th>
                            </tr>
                        </thead>
                        <tbody id="dashRecentTx">
                            </tbody>
                    </table>
                </div>
                <div id="emptyState" style="text-align: center; padding: 20px; color: #999; display: none;">
                    Belum ada transaksi tercatat.
                </div>
            </div>
        </div>

        <div id="transactionPage" class="page">
            <h1 style="margin-bottom: 24px;">Catat Transaksi</h1>
            <div class="onboarding-container" style="max-width: 100%; margin: 0;">
                <div class="form-grid">
                    <div class="form-group">
                        <label>Jenis Transaksi</label>
                        <div class="radio-group">
                            <div class="radio-option">
                                <input type="radio" name="txType" id="typeIn" value="income" checked onchange="updateCategories()">
                                <label for="typeIn" class="radio-label">üì• Pemasukan</label>
                            </div>
                            <div class="radio-option">
                                <input type="radio" name="txType" id="typeOut" value="expense" onchange="updateCategories()">
                                <label for="typeOut" class="radio-label">üì§ Pengeluaran</label>
                            </div>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Tanggal</label>
                        <input type="date" id="txDate">
                    </div>

                    <div class="form-group">
                        <label>Kategori</label>
                        <select id="txCategory">
                            </select>
                    </div>

                    <div class="form-group">
                        <label>Jumlah (Rp)</label>
                        <input type="text" id="txAmount" placeholder="0" class="currency-input" inputmode="numeric">
                    </div>

                    <div class="form-group">
                        <label>Keterangan / Deskripsi</label>
                        <input type="text" id="txDesc" placeholder="Contoh: Iuran anggota, Beli ATK">
                    </div>

                    <button class="btn-next" onclick="saveTransaction()">Simpan Transaksi</button>
                </div>
            </div>
        </div>

        <div id="analysisPage" class="page">
            <h1 style="margin-bottom: 24px;">Monitor & Analisis</h1>
            
            <div class="dashboard-grid">
                <div class="stat-card">
                    <div class="stat-title">Total Pemasukan</div>
                    <div class="stat-value" style="color: #10B981;" id="anaIncome">Rp 0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">Total Pengeluaran</div>
                    <div class="stat-value" style="color: #EF4444;" id="anaExpense">Rp 0</div>
                </div>
            </div>

            <div class="content-card" style="margin-top: 20px;">
                <h3>Grafik Sederhana (Bar)</h3>
                <div id="chartContainer" class="simple-chart">
                    </div>
            </div>

            <div class="content-card" style="margin-top: 20px;">
                <h3>Semua Riwayat Transaksi</h3>
                <div class="table-responsive">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Tanggal</th>
                                <th>Tipe</th>
                                <th>Kategori</th>
                                <th>Deskripsi</th>
                                <th>Jumlah</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="fullHistoryTable">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="notificationPage" class="page">
            <h1 style="margin-bottom: 24px;">Notifikasi</h1>
            <div class="content-card">
                <div id="notifList">
                    </div>
            </div>
        </div>

        <div id="settingsPage" class="page">
            <h1 style="margin-bottom: 24px;">Pengaturan</h1>
            <div class="onboarding-container" style="max-width: 100%; margin: 0;">
                <h3 style="margin-bottom: 15px;">Profil & Bisnis</h3>
                <div class="form-group">
                    <label>Nama Bisnis</label>
                    <input type="text" id="setBusinessName">
                </div>
                <div class="form-group">
                    <label>Batas Saldo Minimum (Peringatan)</label>
                    <input type="text" id="setMinBalance" class="currency-input" inputmode="numeric">
                </div>
                
                <h3 style="margin-top: 30px; margin-bottom: 15px;">Manajemen Data</h3>
                <button class="btn-back" style="background: #EF4444; color: white;" onclick="resetData()">‚ö†Ô∏è Reset Semua Data (Hapus)</button>
                <button class="btn-next" onclick="saveSettings()">Simpan Perubahan</button>
            </div>
        </div>

    </div>

    <script>
        // --- DATA STORE & STATE MANAGEMENT ---
        let appData = {
            isSetup: false,
            businessName: "Bisnis Saya",
            userName: "User",
            initialBalance: 0,
            minBalance: 100000,
            transactions: [],
            categories: {
                income: ['Iuran Wajib', 'Donasi', 'Penjualan', 'Lainnya'],
                expense: ['Konsumsi', 'Perlengkapan', 'Transportasi', 'Sewa', 'Lainnya']
            }
        };

        // --- FORMATTING CURRENCY INPUT (Logic Baru) ---
        // Mencari semua input dengan class 'currency-input'
        document.addEventListener('DOMContentLoaded', () => {
            const currencyInputs = document.querySelectorAll('.currency-input');
            currencyInputs.forEach(input => {
                // Saat user mengetik
                input.addEventListener('keyup', function(e) {
                    // 1. Ambil value dan buang semua karakter selain angka
                    let value = this.value.replace(/\D/g, '');
                    
                    // 2. Format dengan titik setiap ribuan
                    let formatted = new Intl.NumberFormat('id-ID').format(value);
                    
                    // 3. Kembalikan ke input field
                    // (Handling empty string agar tidak muncul '0' atau NaN)
                    this.value = value ? formatted : '';
                });
            });

            // Load data
            loadData();
        });

        // Helper untuk membersihkan titik sebelum disimpan ke database
        function parseRawMoney(str) {
            if(!str) return 0;
            // Hapus titik, konversi ke integer
            return parseInt(str.toString().replace(/\./g, '')) || 0;
        }

        // --- LOAD DATA ---
        function loadData() {
            const savedData = localStorage.getItem('kelolaKitaData');
            if (savedData) {
                appData = JSON.parse(savedData);
            } else {
                document.getElementById('txDate').valueAsDate = new Date();
            }
            
            document.getElementById('welcomeName').textContent = appData.userName;
            document.getElementById('displayCompanyName').textContent = appData.businessName;
            
            // Jika sudah setup, default ke halaman Home (Dashboard)
            // Jika belum, default ke halaman Home (Welcome)
            showPage('home');
            updateCategories();
        }

        function saveData() {
            localStorage.setItem('kelolaKitaData', JSON.stringify(appData));
            updateDashboard();
        }

        function formatRupiah(number) {
            return new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR' }).format(number);
        }

        // --- NAVIGATION LOGIC (Revised for Home Merge) ---
        function showPage(page) {
            const pages = document.querySelectorAll('.page');
            pages.forEach(p => p.classList.remove('active'));

            const menuItems = document.querySelectorAll('.menu-item');
            menuItems.forEach(item => item.classList.remove('active'));

            // LOGIKA UTAMA PERUBAHAN HALAMAN
            if (page === 'home') {
                // Menu Active: Beranda (index 0)
                menuItems[0].classList.add('active');

                if (appData.isSetup) {
                    // Jika SUDAH setup -> Tampilkan Dashboard (Ringkasan Kas)
                    document.getElementById('dashboardPage').classList.add('active');
                    updateDashboard(); // Refresh data dashboard
                } else {
                    // Jika BELUM setup -> Tampilkan Welcome Page
                    document.getElementById('welcomePage').classList.add('active');
                }
            } 
            else if (page === 'onboarding') {
                // Khusus halaman setup
                document.getElementById('onboardingPage').classList.add('active');
            }
            else {
                // Halaman standar lainnya
                const target = document.getElementById(page + 'Page');
                if(target) target.classList.add('active');

                if(page === 'transaction') {
                    menuItems[1].classList.add('active'); // Sesuaikan index karena Ringkasan dihapus
                    document.getElementById('txDate').valueAsDate = new Date();
                }
                if(page === 'analysis') {
                    menuItems[2].classList.add('active');
                    renderAnalysis();
                }
                if(page === 'notification') {
                    menuItems[3].classList.add('active');
                    renderNotifications();
                }
                if(page === 'settings') {
                    menuItems[4].classList.add('active');
                    document.getElementById('setBusinessName').value = appData.businessName;
                    
                    // Format tampilan di pengaturan saat dibuka
                    document.getElementById('setMinBalance').value = new Intl.NumberFormat('id-ID').format(appData.minBalance);
                }
            }
        }

        // --- ONBOARDING LOGIC ---
        let currentStep = 1;
        const totalSteps = 4;
        
        document.getElementById('nextBtn').addEventListener('click', () => {
            if (currentStep < totalSteps) {
                // Validasi Step 3
                if (currentStep === 3) {
                    // Ambil nilai raw tanpa titik
                    const initBal = parseRawMoney(document.getElementById('initialBalance').value);
                    if(initBal <= 0 && document.getElementById('initialBalance').value === "") {
                        alert("Mohon isi Saldo Awal.");
                        return;
                    }
                }
                currentStep++;
                updateSteps();
            } else {
                // FINISH SETUP
                finishSetup();
            }
        });

        document.getElementById('backBtn').addEventListener('click', () => {
            if (currentStep > 1) {
                currentStep--;
                updateSteps();
            }
        });

        function updateSteps() {
            for (let i = 1; i <= totalSteps; i++) {
                const content = document.getElementById('content' + i);
                const stepNumber = document.getElementById('step' + i);
                
                content.classList.remove('active');
                stepNumber.classList.remove('active');
                
                if (i === currentStep) {
                    content.classList.add('active');
                    stepNumber.classList.add('active');
                }
                if (i < currentStep) stepNumber.classList.add('completed');
            }
            const progressPercent = ((currentStep - 1) / (totalSteps - 1)) * 100;
            document.getElementById('progressFill').style.width = progressPercent + '%';
            document.getElementById('backBtn').style.display = currentStep === 1 ? 'none' : 'inline-block';
            document.getElementById('nextBtn').textContent = currentStep === totalSteps ? 'Masuk ke Dashboard' : 'Lanjutkan';
        }

        function finishSetup() {
            appData.businessName = document.getElementById('businessName').value || "Bisnis Saya";
            appData.userName = document.getElementById('userNameInput').value || "User";
            
            // Simpan nilai uang dengan parsing (buang titik)
            appData.minBalance = parseRawMoney(document.getElementById('minBalance').value);
            appData.initialBalance = parseRawMoney(document.getElementById('initialBalance').value);
            
            appData.isSetup = true;
            
            saveData();
            document.getElementById('displayCompanyName').textContent = appData.businessName;
            
            // Redirect ke Home, otomatis mendeteksi setup selesai -> masuk Dashboard
            showPage('home');
        }

        // --- TRANSACTION LOGIC ---
        function updateCategories() {
            const type = document.querySelector('input[name="txType"]:checked').value;
            const select = document.getElementById('txCategory');
            select.innerHTML = "";
            appData.categories[type].forEach(cat => {
                const opt = document.createElement('option');
                opt.value = cat;
                opt.textContent = cat;
                select.appendChild(opt);
            });
        }

        function saveTransaction() {
            const date = document.getElementById('txDate').value;
            const type = document.querySelector('input[name="txType"]:checked').value;
            const category = document.getElementById('txCategory').value;
            
            // Parsing amount dari format "10.000" jadi 10000
            const amount = parseRawMoney(document.getElementById('txAmount').value);
            const desc = document.getElementById('txDesc').value;

            if(!amount || amount <= 0) {
                alert("Jumlah harus lebih dari 0");
                return;
            }

            const newTx = {
                id: Date.now(),
                date: date,
                type: type,
                category: category,
                amount: amount,
                desc: desc || "-"
            };

            appData.transactions.push(newTx);
            appData.transactions.sort((a, b) => new Date(b.date) - new Date(a.date));
            
            saveData();
            alert("Transaksi berhasil disimpan!");
            
            document.getElementById('txAmount').value = "";
            document.getElementById('txDesc').value = "";
            
            // Kembali ke Beranda (yang sekarang isinya dashboard)
            showPage('home');
        }

        // --- DASHBOARD & CALCULATION LOGIC ---
        function updateDashboard() {
            let totalIncome = 0;
            let totalExpense = 0;
            let monthIncome = 0;
            let monthExpense = 0;
            const currentMonth = new Date().getMonth();

            appData.transactions.forEach(tx => {
                if(tx.type === 'income') {
                    totalIncome += tx.amount;
                    if(new Date(tx.date).getMonth() === currentMonth) monthIncome++;
                } else {
                    totalExpense += tx.amount;
                    if(new Date(tx.date).getMonth() === currentMonth) monthExpense++;
                }
            });

            const currentBalance = appData.initialBalance + totalIncome - totalExpense;
            const netFlow = totalIncome - totalExpense;

            document.getElementById('dashBalance').textContent = formatRupiah(currentBalance);
            document.getElementById('dashTxCount').textContent = (monthIncome + monthExpense) + " transaksi";
            document.getElementById('dashTxDetail').textContent = `üì• ${monthIncome} masuk ¬∑ üì§ ${monthExpense} keluar`;
            document.getElementById('dashNetFlow').textContent = formatRupiah(netFlow);

            const statusEl = document.getElementById('dashStatus');
            const statusSub = document.getElementById('dashStatusSub');
            if(currentBalance < appData.minBalance) {
                statusEl.textContent = "‚ö†Ô∏è Kritis";
                statusEl.style.color = "red";
                statusSub.textContent = "Di bawah batas minimum!";
                document.getElementById('notifCount').style.display = "inline-block";
                document.getElementById('notifCount').textContent = "!";
            } else {
                statusEl.textContent = "Aman";
                statusEl.style.color = "green";
                statusSub.textContent = "Kondisi keuangan sehat";
                document.getElementById('notifCount').style.display = "none";
            }

            // Recent Transactions
            const tbody = document.getElementById('dashRecentTx');
            tbody.innerHTML = "";
            const recent = appData.transactions.slice(0, 5);
            
            if(recent.length === 0) {
                document.getElementById('emptyState').style.display = 'block';
            } else {
                document.getElementById('emptyState').style.display = 'none';
                recent.forEach(tx => {
                    const row = `
                        <tr>
                            <td>${tx.date}</td>
                            <td>${tx.desc}</td>
                            <td><span class="chip">${tx.category}</span></td>
                            <td style="color: ${tx.type === 'income' ? 'green' : 'red'}">${tx.type === 'income' ? 'Masuk' : 'Keluar'}</td>
                            <td style="font-weight:bold;">${formatRupiah(tx.amount)}</td>
                        </tr>
                    `;
                    tbody.innerHTML += row;
                });
            }
        }

        // --- ANALYSIS PAGE LOGIC ---
        function renderAnalysis() {
            let income = 0;
            let expense = 0;
            appData.transactions.forEach(tx => {
                if(tx.type === 'income') income += tx.amount;
                else expense += tx.amount;
            });

            document.getElementById('anaIncome').textContent = formatRupiah(income);
            document.getElementById('anaExpense').textContent = formatRupiah(expense);

            const max = Math.max(income, expense) || 1;
            const inPct = (income / max) * 100;
            const exPct = (expense / max) * 100;

            document.getElementById('chartContainer').innerHTML = `
                <div style="display:flex; align-items:flex-end; height: 150px; gap: 50px; padding: 10px;">
                    <div style="width: 100px; text-align: center;">
                        <div style="height: ${inPct}%; background: #10B981; width: 100%; border-radius: 5px 5px 0 0; transition: height 1s;"></div>
                        <div style="margin-top: 5px; font-size: 12px;">Pemasukan</div>
                    </div>
                    <div style="width: 100px; text-align: center;">
                        <div style="height: ${exPct}%; background: #EF4444; width: 100%; border-radius: 5px 5px 0 0; transition: height 1s;"></div>
                        <div style="margin-top: 5px; font-size: 12px;">Pengeluaran</div>
                    </div>
                </div>
            `;

            const tbody = document.getElementById('fullHistoryTable');
            tbody.innerHTML = "";
            appData.transactions.forEach((tx, index) => {
                const row = `
                    <tr>
                        <td>${tx.date}</td>
                        <td>${tx.type === 'income' ? 'üì•' : 'üì§'}</td>
                        <td>${tx.category}</td>
                        <td>${tx.desc}</td>
                        <td>${formatRupiah(tx.amount)}</td>
                        <td><button onclick="deleteTx(${index})" style="color:red; background:none; border:none; cursor:pointer;">Hapus</button></td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }

        function deleteTx(index) {
            if(confirm('Hapus transaksi ini?')) {
                appData.transactions.splice(index, 1);
                saveData();
                renderAnalysis();
            }
        }

        // --- NOTIFICATION & SETTINGS ---
        function renderNotifications() {
            const list = document.getElementById('notifList');
            list.innerHTML = "";
            
            let currentBal = appData.initialBalance;
            appData.transactions.forEach(tx => {
                currentBal += (tx.type === 'income' ? tx.amount : -tx.amount);
            });

            if(currentBal < appData.minBalance) {
                list.innerHTML += `
                    <div class="alert-item" style="background: #FEF2F2; color: #991B1B; padding: 15px; border-radius: 8px; border-left: 4px solid red; margin-bottom: 10px;">
                        <strong>‚ö†Ô∏è Saldo Menipis!</strong><br>
                        Saldo saat ini (${formatRupiah(currentBal)}) di bawah batas minimum (${formatRupiah(appData.minBalance)}).
                    </div>
                `;
            } else {
                list.innerHTML = `<div style="text-align:center; color:#666; padding: 20px;">Tidak ada notifikasi penting saat ini.</div>`;
            }
        }

        function saveSettings() {
            appData.businessName = document.getElementById('setBusinessName').value;
            appData.minBalance = parseRawMoney(document.getElementById('setMinBalance').value);
            saveData();
            document.getElementById('displayCompanyName').textContent = appData.businessName;
            alert("Pengaturan disimpan.");
        }

        function resetData() {
            if(confirm("Yakin ingin menghapus SEMUA data? Ini tidak bisa dibatalkan.")) {
                localStorage.removeItem('kelolaKitaData');
                location.reload();
            }
        }
    </script>
</body>
</html>